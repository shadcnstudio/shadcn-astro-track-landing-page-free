---
import Layout from '@/layouts/Layout.astro'
import { getAllPosts, calculateReadTime } from '@/lib/data-utils'
import Blog from '@/components/blog/blog-component/blog-component'

// Get all blog posts
const allPosts = await getAllPosts()

// Transform posts to match the BlogPost type
const blogData = allPosts.map(post => ({
  id: post.data.id,
  slug: post.data.slug,
  title: post.data.title,
  description: post.data.description,
  imageUrl: post.data.imageUrl || '/images/placeholder.jpg',
  imageAlt: post.data.imageAlt || post.data.title,
  pubDate: post.data.pubDate,
  author: post.data.author,
  avatarUrl: post.data.avatarUrl || '/images/avatar-placeholder.jpg',
  category: post.data.category,
  readTime: calculateReadTime(post.body || ''),
  featured: post.data.featured,
  tags: post.data.tags
}))

const pageTitle = 'Blog'
const pageDescription = 'Read our latest articles about web development, Astro, and modern web technologies.'

const schema = {
  '@context': 'https://schema.org',
  '@graph': [
    // Blog schema
    {
      '@type': 'Blog',
      '@id': `${Astro.site}blog/#blog`,
      name: 'Shadcn Studio Blog',
      description: pageDescription,
      url: `${Astro.site}blog/`,
      inLanguage: 'en-US',
      publisher: {
        '@type': 'Organization',
        name: 'Shadcn Studio',
        logo: {
          '@type': 'ImageObject',
          url: `${Astro.site}images/site-logo.png`
        }
      },
      blogPost: blogData.map(post => ({
        '@type': 'BlogPosting',
        headline: post.title,
        description: post.description,
        image: {
          '@type': 'ImageObject',
          url: new URL(post.imageUrl, Astro.site).toString()
        },
        datePublished: post.pubDate,
        author: {
          '@type': 'Person',
          name: post.author
        },
        url: `${Astro.site}blog/${post.slug}/`,
        keywords: post.tags?.join(', '),
        articleSection: post.category
      }))
    },

    // WebPage schema
    {
      '@type': 'WebPage',
      '@id': `${Astro.site}blog/#webpage`,
      url: `${Astro.site}blog/`,
      name: pageTitle,
      description: pageDescription,
      inLanguage: 'en-US',
      isPartOf: {
        '@type': 'WebSite',
        '@id': `${Astro.site}#website`
      }
    }
  ]
}
---

<Layout title={pageTitle} description={pageDescription} schema={schema}>
  <Blog blogData={blogData} client:load />
</Layout>
